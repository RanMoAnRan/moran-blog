{{ define "main" }}
  <div class="container">
    <div class="post-navigation-top">
      <a href="{{ site.Home.RelPermalink }}" class="back-link">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
        返回首页
      </a>
    </div>

    <article class="post">
      <header class="post-header">
        <!-- 1. Category Pill -->
        <div class="post-category-wrapper">
          {{ range first 1 (.GetTerms "categories") }}
            <a href="{{ .RelPermalink }}" class="category-pill">{{ .Title }}</a>
          {{ end }}
        </div>

        <!-- 2. Title -->
        <h1 class="post-title">{{ .Title }}</h1>

        <!-- 3. Meta Row -->
        <div class="post-meta-row">
           <span class="meta-item">
             <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>
             {{ .Date.Format "2006-01-02" }}
           </span>
           <span class="meta-dot"></span>
           <span class="meta-item">
             <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
             {{ .ReadingTime }} 分钟阅读
           </span>
           <span class="meta-dot"></span>
           <span class="meta-item">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
              {{ site.Params.author | default "Alex" }}
           </span>
        </div>
      </header>

      <div class="post-layout">
        <div class="post-body">
          <div class="prose">
            {{ .Content }}
          </div>

          <!-- Tags Footer -->
          {{ with .GetTerms "tags" }}
          <div class="post-tags-footer">
             {{ range . }}
               <a href="{{ .RelPermalink }}" class="tag-pill">#{{ .Title }}</a>
             {{ end }}
          </div>
          {{ end }}

          {{ $prev := .PrevInSection }}
          {{ $next := .NextInSection }}
          {{ if or $prev $next }}
            <nav class="post-pagination" aria-label="文章导航">
              {{ with $prev }}
                <a class="post-pagination__item" href="{{ .RelPermalink }}" rel="prev">
                  <span class="post-pagination__label">上一篇</span>
                  <span class="post-pagination__title">{{ .LinkTitle }}</span>
                </a>
              {{ end }}
              {{ with $next }}
                <a class="post-pagination__item" href="{{ .RelPermalink }}" rel="next">
                  <span class="post-pagination__label">下一篇</span>
                  <span class="post-pagination__title">{{ .LinkTitle }}</span>
                </a>
              {{ end }}
            </nav>
          {{ end }}

          {{ partial "giscus.html" . }}
        </div>

        {{ if and (or (not (isset .Params "toc")) .Params.toc) .TableOfContents }}
          <aside class="post-aside" aria-label="目录">
            <div class="toc-card">
              <div class="toc-title">目录</div>
              {{ .TableOfContents }}
            </div>
          </aside>
        {{ end }}
      </div>
    </article>
  </div>

  <style>
    .post-navigation-top {
      padding: 20px 0;
    }
    
    .back-link {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: var(--slate-500);
      font-weight: 500;
      padding: 8px 16px;
      border-radius: 8px;
      transition: all 0.2s;
    }
    
    .back-link:hover {
      background: var(--slate-100);
      color: var(--violet-600);
    }

    .post-category-wrapper {
      margin-bottom: 20px;
    }

    .category-pill {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 99px;
      font-size: 0.8rem;
      font-weight: 700;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      background: var(--violet-50);
      color: var(--violet-600);
      border: 1px solid var(--violet-200);
    }

    .post-meta-row {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 12px;
      margin-top: 16px;
      color: var(--slate-400);
      font-size: 0.9rem;
      border-top: 1px solid var(--slate-100);
      border-bottom: 1px solid var(--slate-100);
      padding: 16px 0;
      width: 100%;
    }

    .meta-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .meta-dot {
      width: 4px;
      height: 4px;
      background: var(--slate-300);
      border-radius: 50%;
    }
    
    .post-tags-footer {
      margin-top: 40px;
      padding-top: 20px;
      border-top: 1px solid var(--slate-100);
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    
    .tag-pill {
      padding: 6px 14px;
      border-radius: 8px;
      background: var(--slate-50);
      color: var(--slate-500);
      font-size: 0.9rem;
      border: 1px solid var(--slate-200);
    }
    
    .tag-pill:hover {
      background: var(--violet-50);
      color: var(--violet-600);
      border-color: var(--violet-200);
    }
  </style>
{{ end }}