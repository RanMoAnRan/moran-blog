{{ define "main" }}
  <!-- Hero Section with Background Image -->
  <div style="position: relative; width: 100vw; left: 50%; right: 50%; margin-left: -50vw; margin-right: -50vw; overflow: hidden; margin-bottom: 0;">
    <!-- Background Image -->
    <div style="position: absolute; inset: 0; z-index: -2;" id="hero-bg-container">
      <img id="hero-bg-img" src="{{ "img/bg/bg-01.jpg" | relURL }}" alt="Hero Background" style="width: 100%; height: 100%; object-fit: cover; transition: opacity 0.5s ease-in-out;">
    </div>

    <!-- Background Toggle Button -->
    <button id="bg-toggle-btn" aria-label="切换背景" style="position: absolute; top: 24px; right: 24px; z-index: 10; background: rgba(255, 255, 255, 0.6); backdrop-filter: blur(8px); border: 1px solid rgba(255, 255, 255, 0.4); border-radius: 9999px; padding: 8px; cursor: pointer; color: var(--slate-700); transition: all 0.2s; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 21h5v-5"/></svg>
    </button>
    <script>
      (function() {
        // 使用 Hugo 的 relURL 生成带 baseURL 子路径前缀的地址（例如 GitHub Pages /moran-blog/）。
        // 否则在子路径部署时，`/img/...` 会指向站点根目录导致 404，从而“背景显示不出来”。
        const bgImages = [
          "{{ "img/bg/bg-01.jpg" | relURL }}",
          "{{ "img/bg/bg-02.jpg" | relURL }}",
          "{{ "img/bg/bg-03.jpg" | relURL }}",
          "{{ "img/bg/bg-04.jpg" | relURL }}",
          "{{ "img/bg/bg-05.jpg" | relURL }}",
          "{{ "img/bg/bg-06.jpg" | relURL }}",
          "{{ "img/bg/bg-07.jpg" | relURL }}",
          "{{ "img/bg/bg-08.jpg" | relURL }}",
          "{{ "img/bg/bg-09.jpg" | relURL }}",
          "{{ "img/bg/bg-10.jpg" | relURL }}"
        ];

        const btn = document.getElementById('bg-toggle-btn');
        const img = document.getElementById('hero-bg-img');
        const STORAGE_KEY = 'ink-hero-bg-index';

        let currentIndex = parseInt(localStorage.getItem(STORAGE_KEY) || "0");

        // Ensure index is valid
        if (isNaN(currentIndex) || currentIndex < 0 || currentIndex >= bgImages.length) {
          currentIndex = 0;
        }

        // Initialize image from storage
        // 设置默认图片路径（初始加载）
        const setInitialImage = () => {
             img.src = bgImages[currentIndex];
             // 强制显示，防止之前 opacity 被设置为 0 后卡住
             img.style.opacity = '1';
        };

        setInitialImage();

        btn.addEventListener('click', () => {
          // Add rotation animation to icon
          const icon = btn.querySelector('svg');
          icon.style.transition = 'transform 0.5s ease';
          icon.style.transform = 'rotate(180deg)';
          setTimeout(() => { icon.style.transform = 'rotate(0deg)'; }, 500);

          // Update index
          currentIndex = (currentIndex + 1) % bgImages.length;

          // Save preference
          localStorage.setItem(STORAGE_KEY, currentIndex);

          // Change image DIRECTLY (No complex fade logic to avoid bugs)
          img.src = bgImages[currentIndex];
        });

        // Hover effect
        btn.addEventListener('mouseenter', () => {
          btn.style.background = 'rgba(255, 255, 255, 0.8)';
          btn.style.transform = 'scale(1.05)';
        });
        btn.addEventListener('mouseleave', () => {
          btn.style.background = 'rgba(255, 255, 255, 0.6)';
          btn.style.transform = 'scale(1)';
        });
      })();
    </script>

    <!-- Gradient Overlay for readability -->
    <div style="position: absolute; inset: 0; background: linear-gradient(to bottom, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 40%, var(--bg) 100%); z-index: -1;"></div>
    <div style="position: absolute; inset: 0; background: linear-gradient(to right, rgba(255,255,255,0.1), transparent 15%, transparent 85%, rgba(255,255,255,0.1)); z-index: -1;"></div>

    <div class="container" style="position: relative; padding: 110px 0 120px; text-align: center; max-width: 896px; margin: 0 auto;">
      <!-- Hero Background Glow Elements (Optional, kept for subtle effect) -->
      <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 500px; height: 300px; background: rgba(255,255,255,0.6); filter: blur(80px); border-radius: 9999px; z-index: -1; pointer-events: none;"></div>

      <h1 style="font-size: clamp(3rem, 5vw, 4.5rem); font-family: var(--font-serif); font-weight: 900; color: var(--slate-900); margin-bottom: 24px; letter-spacing: -0.025em; line-height: 1; text-shadow: 0 2px 10px rgba(255,255,255,0.8);">
        Ink & Thought
      </h1>
      <p style="font-size: clamp(1.25rem, 2vw, 1.5rem); color: var(--slate-700); line-height: 1.625; font-weight: 500; margin-bottom: 32px; text-shadow: 0 1px 2px rgba(255,255,255,0.8);">
        记录代码与生活的间隙
      </p>
      <div style="display: flex; justify-content: center; gap: 16px;">
        <a href="#latest-posts" class="btn btn-primary" style="padding: 12px 32px; border-radius: 9999px; box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);">
          开始阅读
        </a>
        <a href="{{ "subscribe" | relURL }}" class="btn btn-outline hero-glass" style="padding: 12px 32px; border-radius: 9999px; background: rgba(255,255,255,0.8);">
          订阅清单
        </a>
      </div>
    </div>
  </div>

  <div class="container">
    <!-- Latest Posts Section -->
    <div id="latest-posts" style="max-width: 896px; margin: 0 auto;">
      <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; padding: 0 8px;">
        <h2 style="font-weight: 700; color: var(--slate-900); font-size: 1.25rem; display: flex; align-items: center; gap: 8px;">
          <span style="display: flex; align-items: center; justify-content: center; width: 24px; height: 24px; border-radius: 9999px; background: var(--violet-100); color: var(--violet-600);">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 3v4"/><path d="M3 9h4"/><path d="M3 5h4"/></svg>
          </span>
          最新文章
        </h2>
        <a href="{{ "posts" | relURL }}" style="font-size: 0.875rem; font-weight: 500; color: var(--slate-500); display: flex; align-items: center; gap: 4px; transition: color 0.2s;" onmouseover="this.style.color='var(--violet-600)'" onmouseout="this.style.color='var(--slate-500)'">
          查看全部 
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
        </a>
      </div>
      
      <div style="display: grid; gap: 0px;">
        {{ $pages := where site.RegularPages "Section" "posts" }}
        {{ $limit := int (site.Params.homelatestcount | default 8) }}
        {{ range first $limit $pages.ByDate.Reverse }}
          {{ partial "post-card.html" . }}
        {{ end }}
      </div>
    </div>
  </div>
{{ end }}
