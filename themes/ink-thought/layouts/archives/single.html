{{ define "main" }}
  <div class="container">
    <div class="content post-detail-container page-narrow">
      <!-- Archive Header Card -->
      <div class="archive-header-card">
        <div class="archive-sparkle-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 3v4"/><path d="M3 9h4"/><path d="M3 5h4"/></svg>
        </div>
        <h1 class="archive-title">时光归档</h1>
        <p class="archive-subtitle">共 {{ len (where site.RegularPages "Section" "posts") }} 篇文章，持续更新中...</p>
      </div>

      {{ $pages := where site.RegularPages "Section" "posts" }}
      <div class="archives-timeline">
        {{ $groups := sort ($pages.GroupByDate "2006") "Key" "desc" }}
        {{ $accents := slice "violet" "teal" "pink" "amber" }}
        {{ $itemAccents := slice "violet" "teal" "pink" "amber" "indigo" "emerald" }}
        {{ $scratch := newScratch }}
        {{ range $i, $group := $groups }}
          {{ $accent := index $accents (mod $i (len $accents)) }}
          <div class="timeline-year-group" data-accent="{{ $accent }}">
            <h2 class="timeline-year">{{ $group.Key }}</h2>
            <div class="timeline-items">
              {{ range $j, $p := $group.Pages.ByDate.Reverse }}
                {{ $itemAccentIndex := mod (add $i $j) (len $itemAccents) }}
                {{ $itemAccent := index $itemAccents $itemAccentIndex }}
                {{ $lastAccent := $scratch.Get "lastAccent" }}
                {{ if and $lastAccent (eq $itemAccent $lastAccent) }}
                  {{ $itemAccentIndex = mod (add $itemAccentIndex 1) (len $itemAccents) }}
                  {{ $itemAccent = index $itemAccents $itemAccentIndex }}
                {{ end }}
                {{ $scratch.Set "lastAccent" $itemAccent }}
                <a href="{{ $p.RelPermalink }}" class="timeline-item" data-accent="{{ $itemAccent }}">
                  <time class="timeline-date" datetime="{{ $p.Date.Format "2006-01-02" }}">
                    <span class="timeline-date__month">{{ $p.Date.Format "01" }}月</span>
                    <span class="timeline-date__day">{{ $p.Date.Format "02" }}</span>
                  </time>
                  <div class="timeline-content">
                    <h3 class="timeline-post-title">{{ $p.LinkTitle }}</h3>
                    <div class="timeline-tags">
                      {{ range first 2 ($p.GetTerms "tags") }}
                        <span class="timeline-tag">#{{ .Title }}</span>
                      {{ end }}
                    </div>
                  </div>
                </a>
              {{ end }}
            </div>
          </div>
        {{ end }}
      </div>
    </div>
  </div>

  <style>
    .archive-header-card {
      background:
        repeating-radial-gradient(circle at 82% 24%, rgba(15, 23, 42, 0.028) 0 1px, transparent 1px 22px),
        radial-gradient(1000px 420px at 18% 0%, rgba(251, 191, 36, 0.16), transparent 60%),
        radial-gradient(700px 360px at 90% 0%, rgba(244, 63, 94, 0.07), transparent 55%),
        linear-gradient(to bottom right, rgba(255, 251, 235, 0.98), rgba(254, 243, 199, 0.70), rgba(255, 255, 255, 0.82));
      border-radius: var(--radius-lg);
      padding: 40px;
      color: var(--text-heading);
      position: relative;
      margin-bottom: 48px;
      border: 1px solid var(--border);
      box-shadow: var(--shadow-sm);
      overflow: hidden;
    }

    [data-theme='dark'] .archive-header-card {
      background:
        repeating-radial-gradient(circle at 82% 24%, rgba(226, 232, 240, 0.05) 0 1px, transparent 1px 22px),
        radial-gradient(900px 400px at 18% 0%, rgba(217, 119, 6, 0.12), transparent 60%),
        radial-gradient(750px 380px at 90% 0%, rgba(124, 58, 237, 0.10), transparent 55%),
        linear-gradient(to bottom right, rgba(15, 23, 42, 0.86), rgba(30, 41, 59, 0.82));
      border-color: rgba(148, 163, 184, 0.18);
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.04);
    }

    .archive-sparkle-icon {
      position: absolute;
      top: 20px;
      right: 40px;
      color: rgba(217, 119, 6, 0.18);
      transform: scale(3) rotate(12deg);
    }

    [data-theme='dark'] .archive-sparkle-icon {
      color: rgba(251, 191, 36, 0.14);
    }

    .archive-title {
      font-family: var(--font-serif);
      font-size: 2rem;
      font-weight: 700;
      margin: 0 0 8px;
      color: var(--text-heading);
      position: relative;
      z-index: 10;
    }

    .archive-subtitle {
      color: var(--text-muted);
      font-size: 1rem;
      opacity: 0.9;
      position: relative;
      z-index: 10;
    }

    [data-theme='dark'] .archive-subtitle {
      color: rgba(226, 232, 240, 0.85);
      opacity: 1;
    }

    .archives-timeline {
      padding: 0 16px;
    }

    .timeline-year-group {
      --year-accent: #7c3aed;          /* violet-600 */
      --year-accent-soft: rgba(124, 58, 237, 0.18);
      --year-line: rgba(124, 58, 237, 0.40);
      position: relative;
      padding-left: 32px;
      border-left: 2px solid var(--year-line);
      margin-bottom: 48px;
    }

    .timeline-year-group[data-accent="teal"] {
      --year-accent: #0d9488;          /* teal-600 */
      --year-accent-soft: rgba(13, 148, 136, 0.18);
      --year-line: rgba(13, 148, 136, 0.40);
    }

    .timeline-year-group[data-accent="pink"] {
      --year-accent: #db2777;          /* pink-600 */
      --year-accent-soft: rgba(219, 39, 119, 0.18);
      --year-line: rgba(219, 39, 119, 0.40);
    }

    .timeline-year-group[data-accent="amber"] {
      --year-accent: #d97706;          /* amber-600 */
      --year-accent-soft: rgba(217, 119, 6, 0.18);
      --year-line: rgba(217, 119, 6, 0.40);
    }

    .timeline-year-group::before {
      content: "";
      position: absolute;
      left: -11px;
      top: 0;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--panel);
      border: 4px solid var(--year-accent);
      box-shadow: var(--shadow-sm);
    }

    .timeline-year {
      display: inline-block;
      font-size: clamp(1.75rem, 3vw, 2.25rem);
      font-weight: 900;
      color: var(--year-accent);
      margin: 0 0 16px;
      line-height: 1;
      user-select: none;
      letter-spacing: -0.02em;
      text-shadow: 0 1px 0 rgba(255, 255, 255, 0.55);
      position: relative;
      z-index: 1;
    }
    
    .timeline-items {
      position: relative;
      z-index: 10;
      padding-top: 0;
      display: grid;
      gap: 18px;
    }

    .timeline-item {
      --item-accent: var(--year-accent);
      --item-accent-soft: var(--year-accent-soft);
      --item-line: var(--year-line);
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 16px 16px;
      margin: 0;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: var(--panel);
      box-shadow: var(--shadow-sm);
      transition: transform 0.2s, box-shadow 0.2s, border-color 0.2s;
      position: relative;
      overflow: hidden;
    }

    .timeline-item:hover {
      border-color: var(--item-accent);
      box-shadow: var(--shadow-xl);
      transform: translateY(-2px);
    }

    .timeline-item[data-accent="teal"] {
      --item-accent: #0d9488;
      --item-accent-soft: rgba(13, 148, 136, 0.18);
      --item-line: rgba(13, 148, 136, 0.40);
    }

    .timeline-item[data-accent="pink"] {
      --item-accent: #db2777;
      --item-accent-soft: rgba(219, 39, 119, 0.18);
      --item-line: rgba(219, 39, 119, 0.40);
    }

    .timeline-item[data-accent="amber"] {
      --item-accent: #d97706;
      --item-accent-soft: rgba(217, 119, 6, 0.18);
      --item-line: rgba(217, 119, 6, 0.40);
    }

    .timeline-item[data-accent="indigo"] {
      --item-accent: #4f46e5;
      --item-accent-soft: rgba(79, 70, 229, 0.18);
      --item-line: rgba(79, 70, 229, 0.40);
    }

    .timeline-item[data-accent="emerald"] {
      --item-accent: #059669;
      --item-accent-soft: rgba(5, 150, 105, 0.18);
      --item-line: rgba(5, 150, 105, 0.40);
    }

    .timeline-date {
      width: 52px;
      height: 52px;
      border-radius: 14px;
      border: 1px solid var(--item-line);
      background: var(--item-accent-soft);
      display: grid;
      grid-template-rows: 18px 1fr;
      overflow: hidden;
      flex-shrink: 0;
    }

    .timeline-date__month {
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.65rem;
      font-weight: 900;
      letter-spacing: 0.1em;
      color: #fff;
      background: var(--item-accent);
      line-height: 1;
    }

    .timeline-date__day {
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
      font-weight: 900;
      color: var(--item-accent);
      background: var(--panel);
      line-height: 1;
    }

    .timeline-post-title {
      font-size: 1.125rem;
      font-weight: 700;
      color: var(--slate-700);
      margin: 0;
      transition: color 0.2s;
    }

    .timeline-item:hover .timeline-post-title {
      color: var(--item-accent);
    }
    
    .timeline-tags {
      display: flex;
      gap: 8px;
      margin-top: 4px;
    }

    .timeline-tag {
      display: inline-flex;
      align-items: center;
      padding: 3px 10px;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text-muted);
      background: var(--slate-50);
      border: 1px solid var(--border);
    }

    [data-theme='dark'] .timeline-post-title {
      color: var(--text-main);
    }

    [data-theme='dark'] .timeline-tag {
      background: rgba(255, 255, 255, 0.04);
      border-color: rgba(148, 163, 184, 0.18);
      color: rgba(226, 232, 240, 0.85);
    }
  </style>
{{ end }}
